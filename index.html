<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sylius Toolbox ‚Äî Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- ========== EKRAN LOGOWANIA ========== -->
  <div id="login-screen" class="login-screen">
    <div class="login-card">
      <div class="login-logo">ST</div>
      <h1>Sylius Toolbox</h1>
      <p class="login-subtitle">Panel zarzƒÖdzania i analizy</p>
      <div class="login-fields">
        <input type="url" id="cfg-url" placeholder="Supabase URL (https://xxx.supabase.co)">
        <input type="text" id="cfg-key" placeholder="Klucz anon (eyJhbG...)">
        <button id="cfg-connect" class="btn-primary btn-full">Po≈ÇƒÖcz z bazƒÖ</button>
      </div>
      <p id="cfg-error" class="login-error hidden"></p>
    </div>
  </div>

  <!-- ========== G≈Å√ìWNY LAYOUT ========== -->
  <div id="app" class="hidden">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <div class="sidebar-logo">ST</div>
        <span>Sylius Toolbox</span>
      </div>
      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-tab="overview">
          <span class="nav-icon">üìä</span> PrzeglƒÖd
        </a>
        <a href="#" class="nav-item" data-tab="users">
          <span class="nav-icon">üë•</span> U≈ºytkownicy
        </a>
        <a href="#" class="nav-item" data-tab="tools">
          <span class="nav-icon">üîß</span> Narzƒôdzia
        </a>
        <a href="#" class="nav-item" data-tab="patterns">
          <span class="nav-icon">üïê</span> Wzorce czasowe
        </a>
        <a href="#" class="nav-item" data-tab="feed">
          <span class="nav-icon">üìã</span> Live feed
        </a>
        <a href="#" class="nav-item" data-tab="roi">
          <span class="nav-icon">üí∞</span> ROI i raporty
        </a>
      </nav>
      <div class="sidebar-footer">
        <button id="btn-disconnect" class="btn-link">Roz≈ÇƒÖcz</button>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Top bar -->
      <header class="topbar">
        <div class="topbar-left">
          <button id="sidebar-toggle" class="sidebar-toggle">‚ò∞</button>
          <h2 id="page-title">PrzeglƒÖd</h2>
        </div>
        <div class="topbar-right">
          <select id="date-range" class="select-range">
            <option value="7">Ostatnie 7 dni</option>
            <option value="30" selected>Ostatnie 30 dni</option>
            <option value="90">Ostatnie 90 dni</option>
            <option value="365">Ostatni rok</option>
            <option value="0">Wszystko</option>
          </select>
          <button id="btn-refresh" class="btn-secondary">‚ü≥ Od≈õwie≈º</button>
          <span id="last-refresh" class="topbar-meta"></span>
        </div>
      </header>

      <div class="content">

        <!-- ===== TAB: PRZEGLƒÑD ===== -->
        <section id="tab-overview" class="tab-content">
          <!-- KPI -->
          <div class="kpi-grid">
            <div class="kpi-card">
              <span class="kpi-value" id="kpi-total-uses">‚Äî</span>
              <span class="kpi-label">≈ÅƒÖczne u≈ºycia</span>
              <span class="kpi-trend" id="kpi-total-uses-trend"></span>
            </div>
            <div class="kpi-card accent-purple">
              <span class="kpi-value" id="kpi-time-saved">‚Äî</span>
              <span class="kpi-label">Zaoszczƒôdzony czas</span>
              <span class="kpi-trend" id="kpi-time-saved-trend"></span>
            </div>
            <div class="kpi-card accent-blue">
              <span class="kpi-value" id="kpi-active-users">‚Äî</span>
              <span class="kpi-label">Aktywni u≈ºytkownicy</span>
              <span class="kpi-trend" id="kpi-active-users-trend"></span>
            </div>
            <div class="kpi-card accent-amber">
              <span class="kpi-value" id="kpi-success-rate">‚Äî</span>
              <span class="kpi-label">Wska≈∫nik sukcesu</span>
            </div>
            <div class="kpi-card accent-red">
              <span class="kpi-value" id="kpi-error-count">‚Äî</span>
              <span class="kpi-label">B≈Çƒôdy</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-value" id="kpi-avg-latency">‚Äî</span>
              <span class="kpi-label">≈ör. czas odpowiedzi</span>
            </div>
          </div>

          <!-- Wykresy g≈Ç√≥wne -->
          <div class="charts-grid">
            <div class="chart-card">
              <h3>U≈ºycia w czasie</h3>
              <canvas id="chart-usage-over-time"></canvas>
            </div>
            <div class="chart-card">
              <h3>Zaoszczƒôdzony czas (minuty)</h3>
              <canvas id="chart-time-saved"></canvas>
            </div>
            <div class="chart-card">
              <h3>Podzia≈Ç wg narzƒôdzia</h3>
              <canvas id="chart-by-tool"></canvas>
            </div>
            <div class="chart-card">
              <h3>Sukces / b≈ÇƒÖd / cofniƒôcie</h3>
              <canvas id="chart-success-rate"></canvas>
            </div>
          </div>

          <!-- Szybki przeglƒÖd u≈ºytkownik√≥w -->
          <div class="card">
            <h3>Najaktywniejszy u≈ºytkownicy</h3>
            <canvas id="chart-top-users" height="200"></canvas>
          </div>
        </section>

        <!-- ===== TAB: U≈ªYTKOWNICY ===== -->
        <section id="tab-users" class="tab-content hidden">
          <div class="card">
            <div class="card-header">
              <h3>Wszyscy u≈ºytkownicy</h3>
              <div class="card-actions">
                <input type="text" id="user-search" placeholder="Szukaj u≈ºytkownika..." class="input-search">
                <button id="btn-export-users" class="btn-secondary">üì• Eksport CSV</button>
              </div>
            </div>
            <table class="data-table" id="users-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th class="sortable" data-sort="name">U≈ºytkownik ‚Üï</th>
                  <th class="sortable" data-sort="uses">U≈ºycia ‚Üï</th>
                  <th class="sortable" data-sort="time">Czas zaoszczƒôdzony ‚Üï</th>
                  <th>Sukces %</th>
                  <th>Narzƒôdzia</th>
                  <th class="sortable" data-sort="last">Ostatnia aktywno≈õƒá ‚Üï</th>
                  <th>Szczeg√≥≈Çy</th>
                </tr>
              </thead>
              <tbody id="users-tbody"></tbody>
            </table>
          </div>

          <!-- Adopcja u≈ºytkownik√≥w -->
          <div class="card">
            <h3>Adopcja wtyczki w organizacji</h3>
            <canvas id="chart-adoption" height="200"></canvas>
          </div>

          <div class="card">
            <h3>Kolejno≈õƒá do≈ÇƒÖczania u≈ºytkownik√≥w</h3>
            <table class="data-table">
              <thead>
                <tr><th>#</th><th>U≈ºytkownik</th><th>Email</th><th>Pierwsza aktywno≈õƒá</th><th>Pierwsze narzƒôdzie</th></tr>
              </thead>
              <tbody id="adoption-tbody"></tbody>
            </table>
          </div>

          <!-- Panel szczeg√≥≈Ç√≥w u≈ºytkownika -->
          <div id="user-detail" class="card hidden">
            <div class="card-header">
              <h3 id="user-detail-name">Szczeg√≥≈Çy u≈ºytkownika</h3>
              <button id="btn-close-user-detail" class="btn-link">‚úï Zamknij</button>
            </div>
            <div class="user-detail-grid">
              <div class="user-stat">
                <span class="user-stat-value" id="ud-uses">‚Äî</span>
                <span class="user-stat-label">U≈ºycia</span>
              </div>
              <div class="user-stat">
                <span class="user-stat-value" id="ud-time">‚Äî</span>
                <span class="user-stat-label">Zaoszczƒôdzony czas</span>
              </div>
              <div class="user-stat">
                <span class="user-stat-value" id="ud-success">‚Äî</span>
                <span class="user-stat-label">Sukces %</span>
              </div>
              <div class="user-stat">
                <span class="user-stat-value" id="ud-fav-tool">‚Äî</span>
                <span class="user-stat-label">Ulubione narzƒôdzie</span>
              </div>
            </div>
            <h4>Aktywno≈õƒá w czasie</h4>
            <canvas id="chart-user-detail-timeline" height="150"></canvas>
            <h4 style="margin-top:16px">Ostatnie akcje</h4>
            <table class="data-table">
              <thead>
                <tr><th>Data</th><th>Narzƒôdzie</th><th>Akcja</th><th>Status</th><th>Produkt</th><th>Szczeg√≥≈Çy</th></tr>
              </thead>
              <tbody id="ud-events-tbody"></tbody>
            </table>
          </div>
        </section>

        <!-- ===== TAB: NARZƒòDZIA ===== -->
        <section id="tab-tools" class="tab-content hidden">
          <div id="tools-cards-grid" class="tools-cards-grid"></div>

          <div class="charts-grid">
            <div class="chart-card">
              <h3>Popularno≈õƒá narzƒôdzi w czasie</h3>
              <canvas id="chart-tools-over-time"></canvas>
            </div>
            <div class="chart-card">
              <h3>≈öredni czas odpowiedzi webhook (ms)</h3>
              <canvas id="chart-tools-latency"></canvas>
            </div>
          </div>

          <div class="card">
            <h3>Najczƒô≈õciej edytowane produkty</h3>
            <table class="data-table">
              <thead>
                <tr><th>#</th><th>Produkt</th><th>URL</th><th>U≈ºycia</th><th>Ostatnio</th></tr>
              </thead>
              <tbody id="products-tbody"></tbody>
            </table>
          </div>
        </section>

        <!-- ===== TAB: WZORCE CZASOWE ===== -->
        <section id="tab-patterns" class="tab-content hidden">
          <div class="card">
            <h3>Heatmapa aktywno≈õci (godzina √ó dzie≈Ñ tygodnia)</h3>
            <div id="heatmap-container" class="heatmap-container"></div>
          </div>
          <div class="charts-grid">
            <div class="chart-card">
              <h3>Aktywno≈õƒá wg godziny</h3>
              <canvas id="chart-by-hour"></canvas>
            </div>
            <div class="chart-card">
              <h3>Aktywno≈õƒá wg dnia tygodnia</h3>
              <canvas id="chart-by-weekday"></canvas>
            </div>
          </div>
        </section>

        <!-- ===== TAB: LIVE FEED ===== -->
        <section id="tab-feed" class="tab-content hidden">
          <div class="card">
            <div class="card-header">
              <h3>Ostatnie zdarzenia</h3>
              <div class="card-actions">
                <label><input type="checkbox" id="feed-auto-refresh" checked> Auto-od≈õwie≈ºanie (30s)</label>
                <button id="btn-export-feed" class="btn-secondary">üì• Eksport CSV</button>
              </div>
            </div>
            <table class="data-table" id="feed-table">
              <thead>
                <tr>
                  <th>Data i godzina</th>
                  <th>U≈ºytkownik</th>
                  <th>Narzƒôdzie</th>
                  <th>Akcja</th>
                  <th>Status</th>
                  <th>Produkt</th>
                  <th>Pola</th>
                  <th>Latency</th>
                  <th>Wersja</th>
                  <th>Szczeg√≥≈Çy</th>
                </tr>
              </thead>
              <tbody id="feed-tbody"></tbody>
            </table>

            <!-- Modal szczeg√≥≈Ç√≥w zdarzenia -->
            <div id="event-detail-modal" class="modal-overlay hidden">
              <div class="modal-card">
                <div class="modal-header">
                  <h3 id="modal-title">Szczeg√≥≈Çy zdarzenia</h3>
                  <button id="btn-close-modal" class="btn-link">‚úï Zamknij</button>
                </div>
                <div class="modal-body">
                  <div class="modal-section">
                    <h4>Dane wys≈Çane (request)</h4>
                    <pre id="modal-request" class="json-pre">‚Äî</pre>
                  </div>
                  <div class="modal-section">
                    <h4>Dane odebrane (response)</h4>
                    <pre id="modal-response" class="json-pre">‚Äî</pre>
                  </div>
                  <div class="modal-section" id="modal-error-section" style="display:none">
                    <h4>B≈ÇƒÖd</h4>
                    <pre id="modal-error" class="json-pre error-pre">‚Äî</pre>
                  </div>
                </div>
              </div>
            </div>
            <div class="feed-pagination">
              <button id="feed-prev" class="btn-secondary" disabled>‚Üê Poprzednie</button>
              <span id="feed-page-info">Strona 1</span>
              <button id="feed-next" class="btn-secondary">Nastƒôpne ‚Üí</button>
            </div>
          </div>
        </section>

        <!-- ===== TAB: ROI I RAPORTY ===== -->
        <section id="tab-roi" class="tab-content hidden">
          <div class="card">
            <h3>Kalkulator ROI</h3>
            <div class="roi-grid">
              <div class="roi-input-group">
                <label>≈örednia stawka godzinowa brutto (PLN)</label>
                <input type="number" id="roi-hourly-rate" value="100" min="1" class="roi-input">
              </div>
              <div class="roi-input-group">
                <label>Liczba roboczych dni w miesiƒÖcu</label>
                <input type="number" id="roi-work-days" value="21" min="1" class="roi-input">
              </div>
            </div>
            <div class="roi-results-grid">
              <div class="roi-result-card">
                <span class="roi-result-value" id="roi-total-hours">‚Äî</span>
                <span class="roi-result-label">Zaoszczƒôdzonych godzin</span>
              </div>
              <div class="roi-result-card accent-green">
                <span class="roi-result-value" id="roi-total-money">‚Äî</span>
                <span class="roi-result-label">Zaoszczƒôdzonych PLN</span>
              </div>
              <div class="roi-result-card">
                <span class="roi-result-value" id="roi-monthly-avg">‚Äî</span>
                <span class="roi-result-label">≈örednio PLN / miesiƒÖc</span>
              </div>
              <div class="roi-result-card">
                <span class="roi-result-value" id="roi-fte-equivalent">‚Äî</span>
                <span class="roi-result-label">Ekwiwalent etat√≥w</span>
              </div>
            </div>
          </div>

          <div class="charts-grid">
            <div class="chart-card">
              <h3>Oszczƒôdno≈õci w czasie (PLN)</h3>
              <canvas id="chart-roi-over-time"></canvas>
            </div>
            <div class="chart-card">
              <h3>Oszczƒôdno≈õci wg narzƒôdzia (PLN)</h3>
              <canvas id="chart-roi-by-tool"></canvas>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Podsumowanie raportowe</h3>
              <button id="btn-export-report" class="btn-primary">üì• Eksport pe≈Çnego raportu CSV</button>
            </div>
            <div id="report-summary"></div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <script src="lib/supabase-client.js"></script>
  <script src="lib/charts.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>
